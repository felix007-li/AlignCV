import { State, Selector, Action, StateContext } from '@ngxs/store'; export interface CheckoutModel{ url?:string; lastPlan?:'pass14'|'monthly'; currency?:'USD'; } export class OpenCheckout{ static readonly type='[Checkout] Open'; constructor(public plan:'pass14'|'monthly', public currency:'USD'){} } export class SetCheckoutUrl{ static readonly type='[Checkout] SetUrl'; constructor(public url:string){} } @State<CheckoutModel>({name:'checkout',defaults:{}}) export class CheckoutState{ @Selector() static url(s:CheckoutModel){return s.url;} @Action(OpenCheckout) async open(ctx:StateContext<CheckoutModel>,{plan,currency}:OpenCheckout){ ctx.patchState({lastPlan:plan,currency}); const res=await fetch('/api/checkout/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan,currency})}); const data=await res.json(); if(data?.url){ ctx.patchState({url:data.url}); window.location.href=data.url; } } @Action(SetCheckoutUrl) set(ctx:StateContext<CheckoutModel>,{url}:SetCheckoutUrl){ ctx.patchState({url}); } }