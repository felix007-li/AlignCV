import { State, Selector, Action, StateContext } from '@ngxs/store'; export interface JdModel{ lang?:string; keywords:string[]; } export class JdDetectLanguage{ static readonly type='[JD] DetectLanguage'; constructor(public text:string){} } export class JdExtractKeywords{ static readonly type='[JD] ExtractKeywords'; constructor(public text:string){} } @State<JdModel>({name:'jd',defaults:{keywords:[]}}) export class JdState{ @Selector() static lang(s:JdModel){return s.lang||'en';} @Selector() static keywords(s:JdModel){return s.keywords;} @Action(JdDetectLanguage) detect(ctx:StateContext<JdModel>,{text}:JdDetectLanguage){const es=/(\bel|\bla|\bde|\bpara|\bcon)\b/i.test(text); const pt=/(\bde|\bpara|\bcom|\buma|\buns)\b/i.test(text); const fr=/(\ble|\bla|\bde|\bpour|\bavec)\b/i.test(text); const lang=es?'es':pt?'pt':fr?'fr':'en'; ctx.patchState({lang});} @Action(JdExtractKeywords) kw(ctx:StateContext<JdModel>,{text}:JdExtractKeywords){const words=Array.from(new Set(text.toLowerCase().match(/[a-z]{4,}/g)||[])).slice(0,8); ctx.patchState({keywords:words});}}